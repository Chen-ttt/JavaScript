<!--
 * @Description:
 * @Author: Tong Chen
 * @Date: 2022-09-29 09:27:33
 * @LastEditTime: 2022-10-10 14:09:03
 * @LastEditors:
-->

# **前端协作规范**

## 工作流规范

### 开发

1. **版本规范 X.Y.Z**

> - 主版本号 - 当做了不兼容的版本修改
> - 次版本号 - 当做了向下兼容的功能性新增
> - 修订号 - 当做了向下兼容的问题修正

2. **版本控制规范 Git**

- 比较流行的 git 分支模型/工作流是 git-flow, 团队需要根据项目的规模, 类型和团队成员的结构来决定工作流
- Gitflow 工作流 -> 功能分支工作流 -> 集中式工作流
  <br>
- **Gitflow**
  Gitflow 是 Git 工作流程的抽象概念, git-flow 工具集是一个具有安装过程的实际命令行工具

  ![Git Flow](https://img-blog.csdnimg.cn/03d348c974434090b404ce4cbf004b7e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6KiA5bCt,size_20,color_FFFFFF,t_70,g_se,x_16)

  - **Main 分支**
    > 储存官方发布记录, 只包含最新的发布版本
  - **Develop 分支**
    > 功能的集成分支, 包含项目的完整历史记录
  - **Feature 分支**
    > 1. 每一个新功能都应该创建一个自己的 Feature 分支
    > 2. 它应该从最新的 Develop 分支拷贝创建, 待功能完成之后, 合并回 Develop
    > 3. 该分支不应该直接和 Main 分支交互
  - **Release 分支**
    > 1. 一旦 Develop 具备发布条件, 就可以从 Develop 分支中创建出 Release 分支
    > 2. 在该分支内不再添加新功能, 只有 bugfix, 文档编辑和其他面向发布的任务才能在 Release 分支中进行
    > 3. 在可以发布后, 将 Release 分支合并到 Main, 并打上版本号标记
    > 4. 此外, 还应该将此时的 Release 重新合并到 Develop 中, 最后被删除
  - **Hotfix 分支**
    > 用于快速修补版本 bug 的临时分支, 直接从 Main 分支 clone 出来, 修复完后, 再合并到 Main 或者当前版本分支中

3. **提交信息规范**

- 应规定统一的 commit 信息的格式
- 版本库不只是存放代码的仓库, 也用于记录项目的开发日志, 因此应该清晰的表达这次提交做了什么, 帮助其他成员快速学习和回顾代码

### 构建规范

- vue-cli3 / create-react-app

- 约定大于配置, 使团队成员更专注于业务开发, 避免他们关心或更改构建的配置细节

### 发布工作流规范

![发布工作流](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/26/16c2c49ed9c29074~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.image)

### 持续集成

### 任务管理

任务看板(例如 Trello), Todo - Doing - Done, 可以帮助团队成员了解项目进度, 资源分配情况等。

## 技术栈规范

技术栈规范主要包括以下几个方面:

- 编程语言
- UI 框架及配套生态:
  - UI 框架
  - 路由
  - 状态管理
  - 组件库
  - 国际化
  - 动画
  - 服务端渲染
  - 手脚架、CLI 工具
  - 组件测试
- 样式 (包括命名规范、预处理器、方法论等等)
- 动画引擎
- QA (包含测试、Lint、格式化工具、监控)
- 项目构建工具流 (例如 webpack、vue-cli)
- 包管理器 (npm、yarn)
- 项目管理工具
- 时间处理
- 模版引擎
- 开发工具
- 后端开发框架
- 工具库
- 开发/调试工具

### 技术选型

- 选择团队熟悉的技术
- 选择拥有强大生态和社区支撑的开源技术
- 选择成长期的技术 (技术应该是向前发展, 面向未来的, 不应当选择过气的技术)
- 技术之间的配合 (例如 Mobx 会破坏 hooks 功能, Vue 和 TS 配合效果不理想)
- 业务考虑 (例如快速开发需求)

### 拥抱新技术

需要考虑学习成本、收益、风险。

## 浏览器兼容规范

根据用户情况、应用类型、开发成本、浏览器市场的统计数据等情况, 制定浏览器兼容规范

### 兼容策略

- 渐进增强
  - 保证低版本浏览器的体验; 对于支持新特性的新浏览器提供稍好的体验
- 优雅降级
  - 为现代浏览器提供最好的体验, 而旧的浏览器保证大概的功能即可

但选择哪种兼容策略, 应该取决于用户比重。

### 确定浏览器分级

根据项目特点和用户比重, 将浏览器划分为多个等级, 不同等级表示不同的支持度, 例如 完全兼容、部分兼容和不兼容。

## 项目组织规范

### 通用的项目组织规范

- README.md
- CHANGELOG.md
  - 描述每个版本变更的内容, 方便用户选择使用哪个版本
- package.json
  - 描述当前的版本、可用的命令、包名、依赖、环境约束、项目配置等信息
- .gitignore
  - 忽略不必要的文件, 避免自动生成的文件提交到版本库
- .gitattributes
  - git 配置, 一些跨平台差异的行为可能需要在这里配置一下, 如换行规则
- docs/
  - 项目的细化文档, 可选
- examples/
  - 项目的示例代码, 可选
- build
  - 项目的工具类脚本, 如果使用统一的构建工具, 则不需要这个目录
- dist/
  - 项目构建结果的输出目录
- src/
  - 源代码
- tests/
  - 单元测试

### 目录组织的风格

## 编码规范

### JS HTML CSS

略

### Code Review

可以让其他成员都熟悉代码, 保证代码质量, 检查或提高新成员的编程水平

## 文档规范

- 建立文档中心: Git + Markdown
- 文档格式: Markdown (支持版本库在线预览和变更历史追踪; 大部分代码编辑支持在线预览)
- 定义文档的模版
  - Eg. API 文档
    - 接口的索引
    - 接口的版本、变更记录
    - 用法、整体描述、认证鉴权
    - 描述具体的接口
      - 功能说明
      - 方法名称或 URL
      - 参数、返回值
      - 调用示例
      - 注意事项等等

## UI 设计规范

- 提高团队协作效率
- 提高组件的复用率, 统一的组件规范可以让组件更好的管理
- 保持产品迭代过程中品牌的一致性

- 不定制自己的 UI 设计规范, 则需要使用现成的开源组件库

## 测试规范

略

## 异常处理、监控及调试规范

- 异常处理 (通用)

  - 异常不要用来做流程控制, 条件控制
  - 捕获异常后一定要处理它; 如果不想处理, 把异常抛给它的调用者; 最外层的业务使用者, 必须要处理异常, 将其转化为用户可以理解的内容

  - catch 的时候分清稳定代码和非稳定代码
    - 稳定代码: 无论如何都不会出错的代码
    - 非稳定代码: 反之; 因此对于非稳定代码的 catch 部分, 尽可能区分异常的类型, 再做对应的处理
  - 不要对大段的代码使用 try-catch, 很难定位出错的部分

- 异常处理 (针对 JS)

  - 不要 throw 非 Error 对象
  - 不要忽略异步异常
  - 全局监控 JavaScript 异常

- 日志

  - 只保留有必要的、有意义的日志, 避免重复 console.log
  - 有选择性地, 谨慎地记录日志: 比如生产环境禁止输出 debug 日志
  - 使用前缀对日志进行分类, 例如: [User] xxxx
  - 只记录关键信息, 这些信息可以帮助开发者诊断问题

- 异常监控

  > 主要用于上报一些意外的或者致命性的异常; 不包括一些预料之内的异常 (eg. 用户输入错误, 网络错误等等)

  1. 全局捕获
     > - 捕获资源加载失败的错误: 通过 addEventListener('error', callback, true)
     > - 捕获 js 执行错误: 使用 window.onerror
     > - 捕获 promise 错误: addEventListener('unhandledrejection', callback), 但没有行数列数等信息, 只能手动抛出相关错误
  2. 主动上报
     > try/catch
  3. 用户反馈

     > 利用弹窗让用户填写反馈信息

  4. 可以维护一个错误数组 errors, 在捕获到错误时添加到相关数组, 一段时间内统一上报

## 前后端协作规范

- 协作流程规范
  ![前后端协作流程](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/26/16c2c4a0cc0fcfc7~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.image)

- 接口规范

  - RESTful: 目前使用最广泛的 API 设计规范, 基于 HTTP 本身的机制来实现
    - Representational State Transfer 表述性状态转移
    - 资源是 RESTful 的核心概念, 所有的设计都以资源为中心, 围绕资源进行增删改查等操作, 围绕资源设计接口
  - JSONRPC
  - GraphQL

  - 需要注意的点
    - 明确区分是正常还是异常, 出现异常时应该返回错误对象的响应, 而不是在正常的响应体中返回错误代码
    - 明确数据类型, string 还是 number, 如果不明确, 前端需要对数据类型做特殊处理, 那么可能会造成潜在的 bug
    - 明确 null 的意义, 表示重置还是表示忽略更新
    - 响应体避免冗余的嵌套
    - 接口版本化, 保持向下兼容: 公共暴露的接口应该有版本号来说明当前的接口都做了什么变化, 是否向下兼容; 当前端代码在客户端被保存, 而某个接口又做了 break change 时, 就会影响到这部分用户

- 接口文档规范 (人工维护接口文档可能导致代码和文档不同步的问题, 因此可以使用 Swagger 或 OpenAPI 这一类 API 生成接口文档)

  - 版本号
  - 文档描述
  - 服务的入口, 如基本路径
  - 简单使用示例
  - 安全和认证
  - 具体接口定义
    - 方法名称/URL
    - 方法描述
    - 请求参数及描述 (数据类型、是否可选等)
    - 响应参数及描述 (数据类型、是否可选等)
    - 可能的异常情况、错误代码以及描述
    - 请求示例

- 接口测试与模拟
